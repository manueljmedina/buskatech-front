---
import { api } from "../../../lib/api";
const products = await api.products();
---

 <form class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end" id="searchForm">
                <div class="md:col-span-1">
                    <label class="block text-left text-gray-700 font-bold mb-2"
                        >Â¿QuÃ© bus<b class="text-brand-yellow">k</b>as?</label
                    ><div class="relative">
                        <select name="type"
                            class="w-full p-3 border border-gray-300 rounded-lg text-gray-800 appearance-none bg-white focus:outline-none focus:ring-2 focus:ring-brand-lightBlue cursor-pointer"
                            >
                          {products.map(p => (
                                <option value={p.uuid}>{p.name}</option>
                            ))}
                                      
                                      </select
                        ><div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"
                        >
                            <svg
                                class="fill-current h-4 w-4"
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 20 20"
                                ><path
                                    d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"
                                ></path></svg
                            >
                        </div>
                    </div>
                </div><div class="md:col-span-1">
                    <label class="block text-left text-gray-700 font-bold mb-2"
                        >Monto ($)</label
                    ><div class="relative">
                        <span
                            class="absolute left-3 top-3 text-gray-500 font-bold"
                            >$</span
                        ><input
                            class="w-full pl-8 p-3 border border-gray-300 rounded-lg text-gray-800 bg-white focus:outline-none focus:ring-2 focus:ring-brand-lightBlue font-medium"
                            placeholder="0.00"
                            type="text"
                            value="15,000.00"
                            name="amount"
                        />
                    </div>
                </div><div class="md:col-span-1">
                    <button
                        type="submit"
                        class="w-full bg-brand-yellow text-brand-blue font-bold text-lg p-3 rounded-lg hover:bg-brand-gold transition-colors duration-200 shadow-md flex justify-center items-center"
                        >Ver Opciones</button
                    >
                </div>
            </form>

<script>
  import { api } from "../../../lib/api";

  document.getElementById("searchForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const form = e.target;

    // ðŸ”¹ BotÃ³n y estado original
    const btn = form.querySelector("button[type=submit]");
    const originalBtnContent = btn.innerHTML;

    // ðŸ”„ Mostrar loading
    btn.disabled = true;
    btn.innerHTML = `
      <span class="animate-spin mr-2 border-2 border-white border-t-transparent rounded-full w-4 h-4"></span>
      Buscando...
    `;

    try {
      const payload = {
        type: form.type.value,
        amount: Number(form.amount.value.replace(/,/g, "")) || undefined,
      };

      console.log("Enviando bÃºsqueda:", payload);

      const response = await api.searchOffers(payload);

      console.log("Resultados:", response);

      // AquÃ­ puedes mostrar resultados, navegar, etcâ€¦
    } catch (error) {
      console.error("Error en la bÃºsqueda:", error);
      alert("OcurriÃ³ un error al obtener las ofertas.");
    } finally {
      // âœ” Restaurar botÃ³n
      btn.disabled = false;
      btn.innerHTML = originalBtnContent;
    }
  });
</script>
